if("undefined"==typeof Product)var Product={};Product.Bundle=Class.create(),Product.Bundle.prototype={initialize:function(e){if(this.config=e,e.defaultValues)for(var i in e.defaultValues)if(this.config.options[i].isMulti){for(var t=new Array,o=0;o<e.defaultValues[i].length;o++)t.push(e.defaultValues[i][o]);this.config.selected[i]=t}else this.config.selected[i]=new Array(e.defaultValues[i]+"");this.reloadPrice()},changeSelection:function(e){var i=e.id.split("-");if(this.config.options[i[2]].isMulti){if(selected=new Array,"SELECT"==e.tagName)for(var t=0;t<e.options.length;t++)e.options[t].selected&&""!=e.options[t].value&&selected.push(e.options[t].value);else if("INPUT"==e.tagName){selector=i[0]+"-"+i[1]+"-"+i[2],selections=$$("."+selector);for(var t=0;t<selections.length;t++)selections[t].checked&&""!=selections[t].value&&selected.push(selections[t].value)}this.config.selected[i[2]]=selected}else this.config.selected[i[2]]=""!=e.value?new Array(e.value):new Array,this.populateQty(i[2],e.value);this.reloadPrice()},reloadPrice:function(){var e=0,i=0,t=0;for(var o in this.config.selected)if(this.config.options[o])for(var s=0;s<this.config.selected[o].length;s++){var n=this.selectionPrice(o,this.config.selected[o][s]);e+=Number(n[0]),i+=Number(n[1]),t+=Number(n[2])}var c=$(document).fire("bundle:reload-price",{price:e,priceInclTax:t,dispositionPrice:i,bundle:this});return c.noReloadPrice||(optionsPrice.specialTaxPrice="true",optionsPrice.changePrice("bundle",e),optionsPrice.changePrice("nontaxable",i),optionsPrice.changePrice("priceInclTax",t),optionsPrice.reload()),e},selectionPrice:function(e,i){if(""==i||"none"==i)return 0;var t=null;if(t=1!=this.config.options[e].selections[i].customQty||this.config.options[e].isMulti?this.config.options[e].selections[i].qty:$("bundle-option-"+e+"-qty-input")?$("bundle-option-"+e+"-qty-input").value:1,"0"==this.config.priceType){price=this.config.options[e].selections[i].price,tierPrice=this.config.options[e].selections[i].tierPrice;for(var o=0;o<tierPrice.length;o++)Number(tierPrice[o].price_qty)<=t&&Number(tierPrice[o].price)<=price&&(price=tierPrice[o].price)}else selection=this.config.options[e].selections[i],price="0"==selection.priceType?selection.priceValue:this.config.basePrice*selection.priceValue/100;var s=this.config.options[e].selections[i].plusDisposition+this.config.options[e].selections[i].minusDisposition;this.config.specialPrice&&(newPrice=price*this.config.specialPrice/100,newPrice=(Math.round(100*newPrice)/100).toString(),price=Math.min(newPrice,price)),selection=this.config.options[e].selections[i],void 0!==selection.priceInclTax?(priceInclTax=selection.priceInclTax,price=void 0!==selection.priceExclTax?selection.priceExclTax:selection.price):priceInclTax=price;var n=new Array(price*t,s*t,priceInclTax*t);return n},populateQty:function(e,i){return""==i||"none"==i?(this.showQtyInput(e,"0",!1),void 0):(1==this.config.options[e].selections[i].customQty?this.showQtyInput(e,this.config.options[e].selections[i].qty,!0):this.showQtyInput(e,this.config.options[e].selections[i].qty,!1),void 0)},showQtyInput:function(e,i,t){elem=$("bundle-option-"+e+"-qty-input"),elem.value=i,elem.disabled=!t,t?elem.removeClassName("qty-disabled"):elem.addClassName("qty-disabled")},changeOptionQty:function(e,i){var t=!0;"undefined"!=typeof i&&(8==i.keyCode||46==i.keyCode)&&(t=!1),t&&(0==Number(e.value)||isNaN(Number(e.value)))&&(e.value=1),parts=e.id.split("-"),optionId=parts[2],this.config.options[optionId].isMulti||(selectionId=this.config.selected[optionId][0],this.config.options[optionId].selections[selectionId].qty=1*e.value,this.reloadPrice())},validationCallback:function(e,i){if(void 0!=e&&void 0!=$(e)){var t=$(e).up("ul.options-list");"undefined"!=typeof t&&("failed"==i?(t.removeClassName("validation-passed"),t.addClassName("validation-failed")):(t.removeClassName("validation-failed"),t.addClassName("validation-passed")))}}};